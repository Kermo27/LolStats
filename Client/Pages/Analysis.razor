@page "/analysis"
@using LolStatsTracker.Shared.DTOs
@using DuoSummary = LolStatsTracker.Shared.DTOs.DuoSummary

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6 mb-8">
    <div class="page-header d-flex align-center gap-4">
        <div class="icon-badge">
            <MudIcon Icon="@Icons.Material.Filled.Analytics" Size="Size.Medium" Color="Color.Surface" />
        </div>
        <div>
            <MudText Typo="Typo.h4" Class="font-weight-bold">Analysis</MudText>
            <MudText Typo="Typo.subtitle1" Color="Color.Secondary">Who to play with and who to avoid?</MudText>
        </div>
    </div>

    @if (_isLoading)
    {
    <MudProgressCircular Indeterminate="true" Color="Color.Primary" />
    }
    else
    {
    <MudGrid Spacing="4">

        <MudItem xs="12" md="6">
            <MudPaper Class="p-4 rounded-xl glass-card" Elevation="0">
                <MudText Typo="Typo.h6" Class="mb-4 font-weight-bold" Color="Color.Success">Top 3 Duo (Best WR)</MudText>
                <MudList T="object" Padding="false" Dense="true"> @foreach (var duo in _duos)
                    {
                    <MudListItem T="object" Class="px-0 py-2"> <div class="d-flex align-center justify-space-between w-100">
                            <div class="d-flex align-center gap-3">
                                <div class="d-flex align-center">
                                    <img src="@LeagueAssetsService.GetChampionIconUrl(duo.Champion)"
                                         height="40" width="40"
                                         style="border-radius: 50%; border: 2px solid var(--mud-palette-primary);" />
                                    <img src="@LeagueAssetsService.GetChampionIconUrl(duo.Support)"
                                         height="30" width="30"
                                         style="border-radius: 50%; border: 2px solid var(--mud-palette-info); margin-left: -10px; z-index: 1;" />
                                </div>
                                <div>
                                    <MudText Typo="Typo.body1" Class="font-weight-bold">@duo.Champion & @duo.Support</MudText>
                                    <MudText Typo="Typo.caption" Class="text-muted">@duo.Count gier | @duo.AvgKda.ToString("F2") KDA</MudText>
                                </div>
                            </div>
                            <MudChip T="string" Color="Color.Success" Variant="Variant.Filled" Size="Size.Small">
                                @duo.WinRate.ToString("F0")% WR
                            </MudChip>
                        </div>
                    </MudListItem>
                    <MudDivider />
                    }
                </MudList>
                @if (!_duos.Any()) { <MudText Class="text-muted">Not enough data (minimum 3 games).</MudText> }
            </MudPaper>
        </MudItem>

        <MudItem xs="12" md="6">
            <MudPaper Class="p-4 rounded-xl glass-card" Elevation="0">
                <MudText Typo="Typo.h6" Class="mb-4 font-weight-bold" Color="Color.Error">Top 3 Hardest Enemy Duo</MudText>
                <MudList T="object" Padding="false" Dense="true"> @foreach (var duo in _worstDuos)
                    {
                    <MudListItem T="object" Class="px-0 py-2"> <div class="d-flex align-center justify-space-between w-100">
                            <div class="d-flex align-center gap-3">
                                <div class="d-flex align-center">
                                    <img src="@LeagueAssetsService.GetChampionIconUrl(duo.Champion)"
                                         height="40" width="40"
                                         style="border-radius: 50%; border: 2px solid var(--mud-palette-error);" />
                                    <img src="@LeagueAssetsService.GetChampionIconUrl(duo.Support)"
                                         height="30" width="30"
                                         style="border-radius: 50%; border: 2px solid var(--mud-palette-error); margin-left: -10px; z-index: 1;" />
                                </div>
                                <div>
                                    <MudText Typo="Typo.body1" Class="font-weight-bold">@duo.Champion & @duo.Support</MudText>
                                    <MudText Typo="Typo.caption" Class="text-muted">@duo.Count games</MudText>
                                </div>
                            </div>
                            <MudChip T="string" Color="Color.Error" Variant="Variant.Filled" Size="Size.Small">
                                @((100 - duo.WinRate).ToString("F0"))% losses
                            </MudChip>
                        </div>
                    </MudListItem>
                    <MudDivider />
                    }
                </MudList>
                @if (!_worstDuos.Any()) { <MudText Class="text-muted">Not enough data (minimum 3 games).</MudText> }
            </MudPaper>
        </MudItem>

        <MudItem xs="12">
            <MudPaper Class="p-4 rounded-xl glass-card" Elevation="0">
                <MudText Typo="Typo.h6" Class="mb-4 gradient-text">Potential Bans (Highest WR Against You)</MudText>

                <MudGrid Spacing="3">
                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Color="Color.Primary" Class="mb-3">Enemy ADC/APC (Bot)</MudText>
                        @if (_enemyBotStats.Any())
                        {
                        <MudList T="object" Padding="false" Dense="true"> @foreach (var enemy in _enemyBotStats.OrderByDescending(e => e.WinrateAgainst).Take(5))
                            {
                            <MudListItem T="object" Class="px-0 py-1"> <div class="d-flex align-center justify-space-between w-100">
                                    <div class="d-flex align-center gap-2">
                                        <img src="@LeagueAssetsService.GetChampionIconUrl(enemy.ChampionName)" height="30" width="30" style="border-radius: 50%; border: 1px solid var(--mud-palette-error);" />
                                        <MudText>@enemy.ChampionName</MudText>
                                    </div>
                                    <MudText Color="Color.Error" Class="font-weight-bold">
                                        @((enemy.WinrateAgainst * 100).ToString("F0"))% losses
                                    </MudText>
                                </div>
                            </MudListItem>
                            }
                        </MudList>
                        }
                    </MudItem>
                    <MudItem xs="12" sm="6">
                        <MudText Typo="Typo.subtitle1" Color="Color.Primary" Class="mb-3">Enemy Support</MudText> @if (_enemySupportStats.Any())
                        {
                        <MudList T="object" Padding="false" Dense="true"> @foreach (var enemy in _enemySupportStats.OrderByDescending(e => e.WinrateAgainst).Take(5))
                            {
                            <MudListItem T="object" Class="px-0 py-1"> <div class="d-flex align-center justify-space-between w-100">
                                    <div class="d-flex align-center gap-2">
                                        <img src="@LeagueAssetsService.GetChampionIconUrl(enemy.ChampionName)" height="30" width="30" style="border-radius: 50%; border: 1px solid var(--mud-palette-error);" />
                                        <MudText>@enemy.ChampionName</MudText>
                                    </div>
                                    <MudText Color="Color.Error" Class="font-weight-bold">
                                        @((enemy.WinrateAgainst * 100).ToString("F0"))% losses
                                    </MudText>
                                </div>
                            </MudListItem>
                            }
                        </MudList>
                        }
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudItem>

    </MudGrid>
    }
</MudContainer>
