@page "/champions"
@using LolStatsTracker.Shared.DTOs

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6 mb-8">
    <div class="page-header d-flex align-center gap-4">
        <div class="icon-badge">
            <MudIcon Icon="@Icons.Material.Filled.People" Size="Size.Medium" Color="Color.Surface" />
        </div>
        <div>
            <MudText Typo="Typo.h4" Class="font-weight-bold">Champion Stats</MudText>
            <MudText Typo="Typo.subtitle1" Color="Color.Secondary">Performance breakdown by champion</MudText>
        </div>
    </div>

    @if (_isLoading)
    {
        <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="rounded-lg"/>
    }
    else
    {
        <MudTable Items="_championStats" 
                  Hover="true" 
                  SortLabel="Sortuj po" 
                  Filter="new Func<ChampionStatsDto,bool>(FilterFunc)"
                  Class="rounded-xl glass-card"
                  Dense="true">
            
        <ToolBarContent>
            <MudText Typo="Typo.h6">All champions</MudText>
            <MudSpacer />
            <MudSelect T="string" @bind-Value="_selectedRole" Label="Role" Variant="Variant.Outlined" Dense="true" 
                       Class="mr-4" Style="width: 150px;">
                <MudSelectItem Value="@("All")">All Roles</MudSelectItem>
                <MudSelectItem Value="@("Top")">Top</MudSelectItem>
                <MudSelectItem Value="@("Jungle")">Jungle</MudSelectItem>
                <MudSelectItem Value="@("Mid")">Mid</MudSelectItem>
                <MudSelectItem Value="@("ADC")">ADC</MudSelectItem>
                <MudSelectItem Value="@("Support")">Support</MudSelectItem>
            </MudSelect>
            <MudSelect T="string" Value="_selectedGameMode" ValueChanged="OnGameModeChanged" Label="Game Mode" Variant="Variant.Outlined" Dense="true"
                       Class="mr-4" Style="width: 180px;">
                <MudSelectItem Value="@("All")">All Modes</MudSelectItem>
                <MudSelectItem Value="@("Ranked Solo")">Ranked Solo</MudSelectItem>
                <MudSelectItem Value="@("Ranked Flex")">Ranked Flex</MudSelectItem>
                <MudSelectItem Value="@("Normal")">Normal</MudSelectItem>
                <MudSelectItem Value="@("Swift Play")">Swift Play</MudSelectItem>
                <MudSelectItem Value="@("ARAM")">ARAM</MudSelectItem>
                <MudSelectItem Value="@("ARAM Mayhem")">ARAM Mayhem</MudSelectItem>
                <MudSelectItem Value="@("URF")">URF</MudSelectItem>
                <MudSelectItem Value="@("ARURF")">ARURF</MudSelectItem>
                <MudSelectItem Value="@("Arena")">Arena</MudSelectItem>
                <MudSelectItem Value="@("Other")">Other</MudSelectItem>
            </MudSelect>
            <MudTextField @bind-Value="_searchString" 
                          Placeholder="Search..." 
                          Adornment="Adornment.Start" 
                          AdornmentIcon="@Icons.Material.Filled.Search" 
                          IconSize="Size.Medium" 
                          Class="mt-0"
                          Clearable="true" />
        </ToolBarContent>

            <HeaderContent>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.ChampionName)">Champion</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.Role)">Role</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.Games)" InitialDirection="SortDirection.Descending">Games</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.Winrate)">Winrate</MudTableSortLabel></MudTh>
                <MudTh>W / L</MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.AvgKda)">KDA</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.AvgCsm)">CS/min</MudTableSortLabel></MudTh>
                <MudTh><MudTableSortLabel SortBy="new Func<ChampionStatsDto, object>(x => x.AvgVisionScore)">Vision</MudTableSortLabel></MudTh>
                <MudTh>Wydajność</MudTh>
            </HeaderContent>
            
            <RowTemplate>
                <MudTd DataLabel="Bohater">
                    <div class="d-flex align-center gap-3">
                        <img src="@LeagueAssetsService.GetChampionIconUrl(context.ChampionName)" 
                             height="40" width="40" 
                             style="border-radius: 50%; object-fit: cover;" />
                        <MudText Class="font-weight-bold">@context.ChampionName</MudText>
                    </div>
                </MudTd>
                
                <MudTd DataLabel="Role">
                    <MudChip T="string" Size="Size.Small" Color="@GetRoleColor(context.Role)" Variant="Variant.Filled">
                        @context.Role
                    </MudChip>
                </MudTd>
                
                <MudTd DataLabel="Gry">
                    <MudText Typo="Typo.body1">@context.Games</MudText>
                </MudTd>

                <MudTd DataLabel="Winrate">
                    <div class="d-flex flex-column" style="width: 100px;">
                        <div class="d-flex justify-space-between mb-1">
                            <MudText Typo="Typo.caption" Class="font-weight-bold" 
                                     Color="@GetWinrateColor(context.Winrate)">
                                @((context.Winrate * 100).ToString("F0"))%
                            </MudText>
                        </div>
                        <MudProgressLinear Color="@GetColor(context.Winrate)" 
                                           Value="@(context.Winrate * 100)" 
                                           Size="Size.Medium" 
                                           Rounded="true" />
                    </div>
                </MudTd>

                <MudTd DataLabel="W/L">
                    <MudText Class="text-success d-inline">@context.Wins W</MudText> / 
                    <MudText Class="text-error d-inline">@context.Losses L</MudText>
                </MudTd>
                
                <MudTd DataLabel="KDA">
                    <MudText Typo="Typo.body2" Class="@GetKdaClass(context.AvgKda)">@context.AvgKda.ToString("F2")</MudText>
                </MudTd>
                
                <MudTd DataLabel="CS/min">
                    <MudText Typo="Typo.body2">@context.AvgCsm.ToString("F1")</MudText>
                </MudTd>
                
                <MudTd DataLabel="Vision Score">
                    <MudText Typo="Typo.body2">@context.AvgVisionScore.ToString("F0")</MudText>
                </MudTd>
                
                <MudTd DataLabel="Performance">
                    @if (context.Games >= 5 && context.Winrate >= 0.6)
                    {
                        <MudChip T="string" Color="Color.Warning" Size="Size.Small" Icon="@Icons.Material.Filled.Star">CARRY</MudChip>
                    }
                    else if (context.Games >= 5 && context.Winrate <= 0.4)
                    {
                        <MudChip T="string" Color="Color.Error" Size="Size.Small" Icon="@Icons.Material.Filled.TrendingDown">INTING</MudChip>
                    }
                    else if (context.Games < 3)
                    {
                        <MudChip T="string" Color="Color.Default" Size="Size.Small" Variant="Variant.Outlined">New</MudChip>
                    }
                </MudTd>
            </RowTemplate>
            
            <PagerContent>
                <MudTablePager RowsPerPageString="Rows per page" />
            </PagerContent>
        </MudTable>
    }
</MudContainer>
