@page "/"
@using LolStatsTracker.Components.Dashboard

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-6 mb-8">
    
    <div class="page-header d-flex align-center justify-space-between gap-4">
        <div class="d-flex align-center gap-4">
            <div class="icon-badge">
                <MudIcon Icon="@Icons.Material.Filled.Dashboard" Size="Size.Medium" Color="Color.Surface" />
            </div>
            <div>
                <MudText Typo="Typo.h4" Class="font-weight-bold">Dashboard</MudText>
                <MudText Typo="Typo.subtitle1" Color="Color.Secondary">Summary for: @(UserState.CurrentProfile?.Name ?? "...")</MudText>
            </div>
        </div>
        
        <div class="d-flex gap-3">
            <MudSelect T="string" Value="_selectedRole" ValueChanged="OnRoleChanged" Label="Role" Variant="Variant.Outlined" Dense="true" Style="min-width: 130px;">
                <MudSelectItem Value="@("All")">All Roles</MudSelectItem>
                <MudSelectItem Value="@("Top")">Top</MudSelectItem>
                <MudSelectItem Value="@("Jungle")">Jungle</MudSelectItem>
                <MudSelectItem Value="@("Mid")">Mid</MudSelectItem>
                <MudSelectItem Value="@("ADC")">ADC</MudSelectItem>
                <MudSelectItem Value="@("Support")">Support</MudSelectItem>
            </MudSelect>
            <MudSelect T="string" Value="_selectedGameMode" ValueChanged="OnGameModeChanged" Label="Game Mode" Variant="Variant.Outlined" Dense="true" Style="min-width: 180px;">
                <MudSelectItem Value="@("All")">All Modes</MudSelectItem>
                <MudSelectItem Value="@("Ranked Solo")">Ranked Solo</MudSelectItem>
                <MudSelectItem Value="@("Ranked Flex")">Ranked Flex</MudSelectItem>
                <MudSelectItem Value="@("Normal")">Normal</MudSelectItem>
                <MudSelectItem Value="@("Swift Play")">Swift Play</MudSelectItem>
                <MudSelectItem Value="@("ARAM")">ARAM</MudSelectItem>
                <MudSelectItem Value="@("ARAM Mayhem")">ARAM Mayhem</MudSelectItem>
                <MudSelectItem Value="@("URF")">URF</MudSelectItem>
                <MudSelectItem Value="@("ARURF")">ARURF</MudSelectItem>
                <MudSelectItem Value="@("Arena")">Arena</MudSelectItem>
                <MudSelectItem Value="@("Other")">Other</MudSelectItem>
            </MudSelect>
        </div>
    </div>

    @if (_stats == null)
    {
        <MudStack AlignItems="AlignItems.Center" Class="mt-10">
            <MudProgressCircular Indeterminate="true" Color="Color.Primary" Size="Size.Large" />
            <MudText Color="Color.Secondary">Analyzing your stats...</MudText>
        </MudStack>
    }
    else
    {
        @if (_stats.TiltStatus.IsTilted)
        {
            <MudAlert Severity="@GetTiltSeverity(_stats.TiltStatus.Level)" 
                      Variant="Variant.Filled" 
                      Class="mb-4 rounded-xl"
                      Icon="@Icons.Material.Filled.Warning">
                <strong>@_stats.TiltStatus.Message</strong>
                <MudText Typo="Typo.caption">Last 5 games: @((_stats.TiltStatus.RecentWinrate * 100).ToString("F0"))% WR</MudText>
            </MudAlert>
        }
        
        <MudGrid Spacing="3">
            
            <MudItem xs="12" sm="6" md="4">
                <StatsOverviewCard Stats="_stats.Overview" />
            </MudItem>
            
            <MudItem xs="12" sm="6" md="4">
                <StreakCard Streak="_stats.Streak" />
            </MudItem>

            <MudItem xs="12" sm="6" md="4">
                <BestDuoCard Duos="_bestDuos" />
            </MudItem>

            <MudItem xs="12" md="4">
                <EnchantersCard Stats="_stats.EnchanterUsage" />
            </MudItem>
        
            <MudItem xs="12" sm="6" md="4">
                <BestTimeCard Stats="_stats.TimeAnalysis" />
            </MudItem>

            <MudItem xs="12" md="7">
                <TopChampionsCard Champions="FilteredChampions" />
            </MudItem>

            <MudItem xs="12" md="5">
                <HardEnemiesCard Enemies="_hardestEnemies" Role="@_selectedRole" />
            </MudItem>
            
            <MudItem xs="12">
                <ActivityHeatmap Matrix="_matrix" MaxGamesPerDay="_maxGamesPerDay" />
            </MudItem>

            <MudItem xs="12">
                <LpTrendChart ChartData="_lpChartData" Series="_lpSeries" Labels="_lpLabels" RangeInfo="_lpRangeInfo" />
            </MudItem>
        </MudGrid>
    }
</MudContainer>

