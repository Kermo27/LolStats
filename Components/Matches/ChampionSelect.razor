<div class="relative inline-block w-full">
    <input type="text"
           @bind="Value"
           @bind:event="oninput"
           placeholder="@Placeholder"
           class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2 text-gray-200
                  focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-150"
           @onfocus="ShowList"
           @onblur="HideListAsync"
           autocomplete="off" />

    @if (showList && FilteredChampions.Any())
    {
        <ul class="absolute z-20 bg-gray-900 border border-gray-700 rounded-lg shadow-lg 
                   w-full mt-1 max-h-52 overflow-auto text-gray-200 p-0 
                   scrollbar-thin scrollbar-thumb-gray-700 scrollbar-track-gray-900"
            @onmousedown:preventDefault>
            @foreach (var champ in FilteredChampions)
            {
                <li class="px-3 py-2 hover:bg-blue-600 hover:text-white cursor-pointer transition-colors"
                    @onmousedown="() => SelectChampion(champ)">
                    @champ
                </li>
            }
        </ul>
    }
</div>

@code {
    [Parameter] public string Value { get; set; } = "";
    [Parameter] public EventCallback<string> ValueChanged { get; set; }
    [Parameter] public List<string> Champions { get; set; } = new();
    [Parameter] public string Placeholder { get; set; } = "Select champion...";
    [Parameter] public int MaxSuggestions { get; set; } = 8;

    private bool showList;

    private IEnumerable<string> FilteredChampions =>
        string.IsNullOrWhiteSpace(Value)
            ? Champions.Take(MaxSuggestions)
            : Champions
                .Where(c => c.Contains(Value, StringComparison.OrdinalIgnoreCase))
                .Take(MaxSuggestions);

    private void ShowList() => showList = true;

    private async Task SelectChampion(string champ)
    {
        Value = champ;
        await ValueChanged.InvokeAsync(champ);
        showList = false;
    }

    private async Task HideListAsync()
    {
        // Małe opóźnienie, żeby zdążył wykonać się onmousedown na li
        await Task.Delay(150);
        showList = false;
        await InvokeAsync(StateHasChanged);
    }
}
