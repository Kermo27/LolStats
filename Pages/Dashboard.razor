@page "/"
@using LolStatsTracker.Components.Dashboard
@using LolStatsTracker.Models
@inject MatchService MatchService

<MudText Typo="Typo.h4" Class="font-bold mb-6">LoL Stats Summary</MudText>

@if (IsLoading)
{
    <MudProgressCircular Indeterminate="true" Color="Color.Primary" Class="m-6" />
}
else if (Matches.Count == 0)
{
    <MudText Color="Color.Secondary">No match data available.</MudText>
}
else
{
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <OverallStatsCard Matches="Matches" />
        <MostPlayedChampionCard Stats="ChampionStats" />
        <FavoriteSupportCard Matches="Matches" />
    </div>

    <ChampionStatsTable Stats="ChampionStats" />
    <SupportsStatsTable Supports="SupportStats" />
    <EnemyStatsTable Enemies="EnemyStats" />
    <EnemySupportsStatsTable Enemies="EnemySupportStats" />
}

@code {
    private bool IsLoading = true;

    private List<MatchEntry> Matches { get; set; } = [];
    private List<MatchStats> ChampionStats { get; set; } = [];
    private List<SupportStats> SupportStats { get; set; } = [];
    private List<EnemyStats> EnemyStats { get; set; } = [];
    private List<EnemySupportStats> EnemySupportStats { get; set; } = [];

    protected override async Task OnInitializedAsync()
    {
        IsLoading = true;

        await MatchService.InitializeAsync();

        Matches = MatchService.GetAll().ToList();
        ChampionStats = MatchService.GetChampionStats().OrderByDescending(s => s.Games).ToList();
        SupportStats = MatchService.GetSupportStats().OrderByDescending(s => s.Games).ToList();
        EnemyStats = MatchService.GetEnemyBotStats().OrderByDescending(e => e.Games).ToList();
        EnemySupportStats = MatchService.GetEnemySupportStats().OrderByDescending(e => e.Games).ToList();

        IsLoading = false;
    }
}